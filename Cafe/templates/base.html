<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ title or "Coffee & Bakery" }}</title>

  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Poppins:wght@300;400;600&family=Caveat:wght@500&display=swap" rel="stylesheet">

  <style>
    :root{--cream:#fdfaf6;--ink:#222;--ink-soft:#4b4b4b;--accent:#b3541e;--card:#fff;--paper:#fffdf9;--stroke:#e9e3da}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,sans-serif;color:var(--ink);background:var(--cream)}
    body.landing{background:radial-gradient(1000px 600px at -10% -20%, rgba(179,84,30,.08), transparent 60%),radial-gradient(900px 500px at 120% 120%, rgba(179,84,30,.06), transparent 60%),var(--cream)}
    body.coffee{background:radial-gradient(800px 500px at 10% 10%, rgba(74,43,29,.10), transparent 60%),radial-gradient(700px 400px at 90% 90%, rgba(179,84,30,.10), transparent 60%),#f7f1ea}
    body.pastries{background:radial-gradient(800px 500px at 90% 10%, rgba(226,125,62,.10), transparent 60%),radial-gradient(700px 400px at 10% 90%, rgba(255,200,150,.12), transparent 60%),#fff7f0}

    header{max-width:1040px;margin:0 auto;padding:18px 20px;display:flex;align-items:center;justify-content:space-between;position:relative;z-index:2}
    /* BRAND: now white */
    .brand{
      font-family:'Playfair Display',serif;font-weight:700;font-size:24px;letter-spacing:.5px;
      color:#fff; text-shadow:0 2px 6px rgba(0,0,0,.25);
    }

    /* right-side, horizontal, underline-on-hover, no bg — now white text */
    .nav{display:flex;gap:18px}
    .nav a{
      position:relative; padding:6px 0;
      color:#fff; text-decoration:none; font-weight:600; opacity:.95;
      text-shadow:0 1px 3px rgba(0,0,0,.25);
    }
    .nav a:hover{opacity:1}
    .nav a::after{
      content:""; position:absolute; left:0; right:0; bottom:-2px; height:2px;
      background: currentColor; transform: scaleX(0); transform-origin:left; transition: transform .15s ease;
    }
    .nav a:hover::after{ transform: scaleX(1); }

    .visits{position:fixed;top:10px;right:16px;font-size:13px;color:#333;background:#ffffffcc;border:1px solid var(--stroke);border-radius:12px;padding:6px 12px;font-weight:600;z-index:3}

    /* Stickers above page bg, below content */
    #stickers-layer{position:fixed;inset:0;pointer-events:none;z-index:1}
    .sticker-float{position:fixed;opacity:.95;filter:drop-shadow(0 6px 8px rgba(0,0,0,.08));mix-blend-mode:multiply;user-select:none}

    .container{max-width:1040px;margin:24px auto 40px;padding:0 20px;position:relative;z-index:2}

    /* Glass card */
    .hero{
      text-align:center; padding:44px 28px; border-radius:20px;
      background: rgba(255,255,255,0.45);
      -webkit-backdrop-filter: blur(12px) saturate(120%);
      backdrop-filter: blur(12px) saturate(120%);
      border: 1px solid rgba(255,255,255,0.6);
      box-shadow: 0 16px 40px rgba(0,0,0,.08);
    }

    /* Receipt look */
    .receipt{width:min(560px,96%);margin:0 auto;padding:36px 26px;background:#fffdfc;border:1px solid #e6dfd3;border-radius:8px;box-shadow:0 18px 40px rgba(0,0,0,.07);position:relative}
    .receipt.paper{background:#fffdfc url("{{ url_for('static', filename='img/receipt-paper.png') }}") center/cover no-repeat;border:1px solid rgba(0,0,0,.06)}
    .receipt h2{font-family:'Playfair Display',serif;margin:0 0 10px}
    .receipt .line{display:flex;justify-content:space-between;margin:6px 0}
    .receipt .muted{color:#666}

    .btn{display:inline-flex;align-items:center;gap:8px;padding:12px 18px;border-radius:12px;font-weight:600;color:#fff;background:var(--ink);border:1px solid var(--ink);text-decoration:none;transition:.15s ease}
    .btn:hover{transform:translateY(-1px);filter:brightness(1.05)}
    .btn.outline{background:transparent;color:var(--ink);border:1px solid var(--stroke)}
    .btn.outline:hover{background:#fff}

    h1,h2,h3{font-family:'Playfair Display',serif;margin:0 0 8px}
    h1{font-size:clamp(28px,4vw,56px)} p.lead{color:var(--ink-soft);margin:0 0 18px}

    .grid{display:grid;gap:16px;grid-template-columns:repeat(auto-fill,minmax(230px,1fr))}
    .menu-item{background:rgba(255,255,255,0.55);backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px);border:1px solid rgba(255,255,255,0.6);border-radius:14px;padding:16px;display:flex;flex-direction:column;gap:10px}
    .menu-item .price{color:var(--accent);font-weight:700}

    footer{max-width:1040px;margin:24px auto 32px;padding:0 20px;color:#7a7a7a;font-size:12px;text-align:center;position:relative;z-index:2}
  </style>

  {% block head %}{% endblock %}
</head>
<body class="{{ theme or 'landing' }}">
  <header>
    <div class="brand">COFFEE &amp; BAKERY</div>
    <nav class="nav">
      <a href="{{ url_for('index') }}">Home</a>
      <a href="{{ url_for('coffee') }}">Coffee</a>
      <a href="{{ url_for('pastries') }}">Pastries</a>
      <a href="{{ url_for('tab_view') }}">Tab</a>
    </nav>
  </header>

  <div class="visits">count: {{ visit_count }}</div>

  {% block page_bg %}{% endblock %}

  <!-- Sticker URLs as JSON -->
  <script id="sticker-data" type="application/json">
    {{ (sticker_urls or []) | tojson }}
  </script>

  <div id="stickers-layer" aria-hidden="true"></div>

  <div class="container">
    {% block content %}{% endblock %}
  </div>

  <footer style="color:#fff;text-shadow:0 1px 2px rgba(0,0,0,0.35);">By yours, sincerely <span aria-hidden="true">❤</span></footer>

  <script>
  (function(){
    const dataTag = document.getElementById('sticker-data');
    let SOURCES = []; try{ SOURCES = JSON.parse(dataTag.textContent || '[]'); }catch(e){}

    const FALLBACKS = [
      'data:image/svg+xml;utf8,'+encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="360" height="140" viewBox="0 0 360 140"><g stroke="#222" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path d="M10 90h340"/><circle cx="40" cy="70" r="12" fill="#fff"/><rect x="28" y="82" width="24" height="14" rx="3" fill="#fff"/><circle cx="90" cy="68" r="12" fill="#fff"/><rect x="78" y="80" width="24" height="16" rx="3" fill="#fff"/><circle cx="140" cy="66" r="12" fill="#fff"/><rect x="128" y="78" width="24" height="18" rx="3" fill="#fff"/><circle cx="190" cy="68" r="12" fill="#fff"/><rect x="178" y="80" width="24" height="16" rx="3" fill="#fff"/><circle cx="240" cy="70" r="12" fill="#fff"/><rect x="228" y="82" width="24" height="14" rx="3" fill="#fff"/><circle cx="290" cy="68" r="12" fill="#fff"/><rect x="278" y="80" width="24" height="16" rx="3" fill="#fff"/></g></svg>'),
      'data:image/svg+xml;utf8,'+encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="180" height="140" viewBox="0 0 180 140"><g fill="none" stroke="#1e3a8a" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M55 40c8-10 22-10 30 0m-10 8v20m-26 32l20-14 18 14M95 88l10 18 22-2"/><circle cx="85" cy="30" r="10" fill="#fff"/><path d="M40 88h24l8 16M126 88h24l-8 16"/><rect x="30" y="88" width="24" height="18" rx="3"/><rect x="126" y="88" width="24" height="18" rx="3"/><path d="M36 88v-8h12v8M132 88v-8h12v8"/></g></svg>')
    ];

    const layer = document.getElementById('stickers-layer');
    const vw = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
    const vh = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
    const isMobile = window.matchMedia('(max-width: 640px)').matches;

    function pickRandom(arr,n){const c=arr.slice();for(let i=c.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[c[i],c[j]]=[c[j],c[i]];}return c.slice(0,n);}
    function rand(min,max){return Math.random()*(max-min)+min;}

    const pool = (SOURCES && SOURCES.length) ? SOURCES : FALLBACKS;
  const count = isMobile ? 2 : Math.min(6, pool.length);
    const chosen = pickRandom(pool, count);

    chosen.forEach(src=>{
      const img=new Image();
      img.className='sticker-float';
      const scale=rand(0.55,0.9), w=180*scale, h=140*scale;
      img.style.width=w+'px';
      img.style.top=rand(110,Math.max(130,vh-h-40))+'px';
      img.style.left=rand(16,Math.max(20,vw-w-16))+'px';
      img.style.transform='rotate('+rand(-8,8)+'deg)';
      img.src=src;
      layer.appendChild(img);
    });
  })();
  </script>
</body>
</html>
